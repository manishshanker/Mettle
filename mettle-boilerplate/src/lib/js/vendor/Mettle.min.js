/*!
 * Copyright 2014 Manish Shanker
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/*!
 * @author Manish Shanker
 * @buildTimestamp 09022014170923
 */
(function(b,a){a.Mettle=b=b||{};
b.init=function(d,c){b.i18nT=c;b.Module=d||{};};}(window.Mettle,window));(function(d,c){function a(e){return new b(c(e));}a.get=function(){return c.get.apply(this,arguments);};a.grep=function(){return c.grep.apply(this,arguments);};var b=function(e){this.$item=e;};b.prototype={on:function(){this.$item.on.apply(this.$item,arguments);
return this;},trigger:function(){this.$item.trigger.apply(this.$item,arguments);return this;},off:function(){this.$item.off.apply(this.$item,arguments);return this;},html:function(e){if(e){this.$item.html(e);return this;}return this.$item.html();},attr:function(e,f){if(f){this.$item.attr(e,f);return this;
}return this.$item.attr(e);},each:function(){this.$item.each.apply(this.$item,arguments);return this;},addClass:function(e){this.$item.addClass(e);return this;},removeClass:function(e){this.$item.removeClass(e);return this;},empty:function(){this.$item.empty();return this;},remove:function(){this.$item.remove();
}};d.DOM=a;}(Mettle,(window.Zepto||window.jQuery)));(function(){var b=function(){};var a=function(c){return typeof c==="function";};b.extend=function(f){var c=function(i){if(i!==a&&a(this.init)){this.init.apply(this,arguments);}};c.prototype=new this(a);var h=function(i,j){return function(){this._super=j;
return i.apply(this,arguments);};};var d;for(d in f){if(f.hasOwnProperty(d)){var e=f[d],g=c.prototype[d];c.prototype[d]=!a(e)||!a(g)?e:h(e,g);}}c.prototype.constructor=c;c.extend=this.extend;return c;};window.Class=b;}());(function(e){e.noop=c;e.each=d;e.infoLogger=(window.console&&window.console.log&&function(){console.info.apply(console,arguments);
})||e.noop;e.logger=(window.console&&window.console.log&&function(){console.log.apply(console,arguments);})||e.noop;e.errorLogger=(window.console&&window.console.log&&function(){console.error.apply(console,arguments);})||e.noop;e.warningLogger=(window.console&&window.console.log&&function(){console.warn.apply(console,arguments);
})||e.noop;function d(f,g){if(f){if(f instanceof Array){b(f,g);}else{a(f,g);}}}function a(f,h){var g;if(f){for(g in f){if(f.hasOwnProperty(g)){h(f[g],g);}}}}function b(h,j){var g,f;if(h){for(g=0,f=h.length;g<f;g++){j(h[g],g);}}}function c(){}}(Mettle));(function(f,e){var c=function(){this.guid=b();this.localMessageBus=e({});
};c.prototype={publish:function(g,h){this.localMessageBus.trigger(g,[h]);},subscribe:function(i,g,h){if(typeof i==="string"){h=g;g=i;i=window;}var j=this;if(typeof g==="string"){return d(j,h,i,g);}var k={};f.each(g,function(m,l){k[l]=d(j,m,i,l);});return k;},unsubscribe:function(g,h){var i=this;if(typeof g==="string"){i.localMessageBus.off(g,h);
}else{f.each(g,function(k,j){i.localMessageBus.off(j,k);});}}};function d(g,k,j,i){var h=function(m,l){k.call(j,l);};g.localMessageBus.on(i,h);return h;}function b(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a();}function a(){return Math.floor((1+Math.random())*65536).toString(16).substring(1);
}f.messaging=new c();f.Messaging=c;}(Mettle,Mettle.DOM));(function(c){c.Base=Class.extend({_guid:null,messageBus:c.messaging,injector:null,guid:function(){if(!this._guid){this._guid=b();}return this._guid;},injectDependencies:function(d){c.dependencyInjector(this,d);}});function b(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a();
}function a(){return Math.floor((1+Math.random())*65536).toString(16).substring(1);}}(Mettle));(function(l){l.Controller=l.Base.extend({autoWire:false,autoDestroy:false,autoShowHide:false,autoLoadControls:false,autoLayout:false,messages:null,injectLocalMessageBus:false,inject:null,routes:{},serviceUpdate:{},messageBus:l.messaging,localMessageBus:null,init:function(u){this.injectDependencies(u);
},views:null,templates:null,controls:null,services:null,shownAndLoaded:false,layoutChange:function(){if(this.autoLayout){r(this.controls,"layoutChange");r(this.views,"layoutChange");}},load:function(){m(this);b(this);},unload:function(){j(this);f(this);},update:function(u){d(this,u);},onUpdateReceive:function(v,u){g(this,v,u);
},destroy:function(){s(this);},onRouteChange:function(){return this.routes;},onServiceUpdate:function(){return this.serviceUpdate;},hide:function(u){o(this);if(!(u&&u.keepPreviousState)){e(this,false,arguments);n(this);}},show:function(u){if(!this.shownAndLoaded){k(this,arguments);this.shownAndLoaded=true;
}else{if(u&&u.keepPreviousState){p(this);}else{a(this,arguments);}}}});function k(u,v){e(u,true,v);i(u);}function a(u,v){e(u,true,v);p(u);}function f(u){r(u.controls,"unload");}function b(u){if(u.autoLoadControls){r(u.controls,"load");}}function i(u){if(!u._exist&&u.autoWire){t(u.services,u);}u._exist=true;
}function n(u){if(u.autoDestroy){u.destroy();}}function p(u){if(u.autoWire){r(u.services,"start");}}function o(u){if(u.autoWire){r(u.services,"stop");}}function g(u,w,v){u.controls[v].update(w);if(u.lastStateData&&u.onServiceUpdate()[v]){u.onServiceUpdate()[v].call(u,u.controls[v],u.lastStateData);}}function d(u,v){if(u.autoWire){q(u,v);
}}function s(u){h(u);j(u);r(u.views,"destroy");r(u.controls,"destroy");r(u.services,"destroy");u.services=null;u.views=null;u.lastStateData=null;u.templates=null;u.options=null;u.controls=null;u._exist=false;u.shownAndLoaded=false;}function h(u){if(u.controlMessages){var v=u.controlMessages;l.messaging.unsubscribe(v.show);
l.messaging.unsubscribe(v.hide);l.messaging.unsubscribe(v.stateChange);}}function j(u){l.each(u.messages,function(v){l.messaging.unsubscribe(v);});}function q(u,v){l.each(u.templates,function(x,w){x.load(function(){if(u.views[w]){u.views[w].render(x.process(v));}});});}function r(v,w,u){u=u||[];l.each(v,function(x){x[w].apply(x,u);
});}function t(u,v){l.each(u,function(w,x){w.onUpdate(c(v,x));w.fetch();});}function c(v,u){return function(w){v.onUpdateReceive(w,u);};}function m(u){if(!(u.messages||u.controlMessages)){return;}h(u);var v=u.controlMessages;l.messaging.subscribe(u,v.show,u.show);l.messaging.subscribe(u,v.hide,u.hide);
l.messaging.subscribe(u,v.stateChange,function(w){u.lastStateData=w;l.each(u.onRouteChange(w),function(y,x){l.navigation.route(u,x,y);});});l.each(u.messages,function(x,w){l.messaging.subscribe(u,w,x);});}function e(w,u,v){if(w.autoShowHide){r(w.views,u?"show":"hide",v);r(w.controls,u?"show":"hide",v);
}}}(Mettle));(function(c,b){var a={};c.Service=c.Base.extend({dataURL:null,init:function(){a[this.guid()]={};a[this.guid()].updateCallBack=[];},fetch:function(){b.get(this.dataURL,function(d){this.updated(d);});},update:c.noop,get:c.noop,lastResult:function(){return a[this.guid()].lastResult;},onUpdate:function(d){a[this.guid()].updateCallBack.push(d);
},updated:function(f){var g,e;var d=a[this.guid()];d.lastResult=f;if(d){for(g=0,e=d.updateCallBack.length;g<e;g++){d.updateCallBack[g](f);}}},destroy:function(){delete a[this.guid()];},stop:c.noop,start:c.noop});}(Mettle,Mettle.DOM));(function(c,b){var a={};c.TemplateByString=function(f){return new c.Template(f,c.Template.LOAD.BY_STRING);
};c.TemplateByID=function(f){return new c.Template(f,c.Template.LOAD.BY_ID);};c.TemplateByURL=function(f){return new c.Template(f,c.Template.LOAD.BY_URL);};c.TemplateSafeString=function(f){return new c.templateEngine.safeString(f);};c.Template=c.Base.extend({init:function(f,g){this.path=f;this.loadBy=g||c.Template.LOAD.DEFAULT;
},process:function(f){if(this.path===undefined){return"";}if(!a[this.guid()]){console.log("Template param: ",this.path,this.loadBy);throw new Error("Template not in cache!!");}return c.templateEngine.process(a[this.guid()],f);},load:function(h){var f=this;if(this.path===undefined||a[this.guid()]){h();
}else{if(f.loadBy===c.Template.LOAD.BY_URL){var g=e(d(c.Template.LOAD.BY_URL_DEFAULT_PATH)+f.path);c.templateEngine.getByURL(g,function(i){a[f.guid()]=i;h.call(f);});}else{if(this.loadBy===c.Template.LOAD.BY_ID){a[this.guid()]=c.templateEngine.getById(this.path);c.templateEngine.remove(this.path);setTimeout(function(){h.call(f);
},5);}else{a[this.guid()]=c.templateEngine.getByString(this.path);setTimeout(function(){h.call(f);},5);}}}},destroy:function(){delete a[this.guid()];}});function e(f){return f+(/\.[a-z]{3,4}$/.test(f)?"":c.Template.LOAD.BY_URL_DEFAULT_EXTENSION);}function d(f){return f+(/\/$/.test(f)?"":"/");}c.Template.LOAD={BY_ID:"APP_TEMPLATE_BY_ID",BY_URL:"APP_TEMPLATE_BY_URL",BY_STRING:"APP_TEMPLATE_BY_STRING",DEFAULT:"APP_TEMPLATE_BY_ID",BY_URL_DEFAULT_PATH:b.Mettle_Template_LOAD_BY_URL_DEFAULT_PATH||"",BY_URL_DEFAULT_EXTENSION:b.Mettle_Template_LOAD_BY_URL_DEFAULT_EXTENSION||".hbs"};
}(Mettle,window));(function(f,e){f.View=f.Base.extend({autoManageEventBind:false,autoLayout:false,init:function(i){this.injectDependencies(i);this.$container=e(this.container);this.$el=this.$container.$item;if(!this.autoManageEventBind){this.bind();}b(this);},container:null,$container:null,bindings:null,layoutChange:f.noop,bind:function(){h(this);
},unbind:function(){a(this);},$el:null,render:function(i){this.$container.html(i);},destroy:function(){var i=this;c(i);i.unbind();i.$container.empty();},hide:function(){var i=this;i.$el.removeClass("show").addClass("hide");d(i);c(i);},show:function(){var i=this;i.$el.removeClass("hide").addClass("show");
g(i);b(i);}});function a(i){f.each(i.bindings,function(k,j){var l=/([a-z]+)\s([a-zA-Z0-9\-\.\(\)>]+)/.exec(j);i.$container.off(l[1],l[2]);});}function h(i){var j=typeof i.bindings==="function"?i.bindings():i.bindings;f.each(j,function(l,k){var m=/([a-z]+)\s([a-zA-Z0-9\-\.\(\)>]+)/.exec(k);i.$container.on(m[1],m[2],function(n){l.call(i,n,this);
});});}function b(i){if(i.autoLayout){e(window).off("resize."+i.guid()).on(("resize."+i.guid()),function(){i.layoutChange();});}}function c(i){if(i.autoLayout){e(window).off("resize."+i.guid());}}function d(i){if(i.autoManageEventBind){i.unbind();}}function g(i){if(i.autoManageEventBind){i.bind();}}}(Mettle,Mettle.DOM));
(function(k){k.dependencyInjector=c;var e={"views":"view","templates":"template","services":"service","controls":"controller"};function c(n,o){if(k.Messaging&&(o instanceof k.Messaging)){n.messageBus=o;}if(n.injectLocalMessageBus){n.localMessageBus=(o&&o.inject&&o.inject.localMessageBus)||new k.Messaging();
}var p=(o&&o.inject)||(n.inject&&(b(n.inject)?n.inject():n.inject));p=j(p);k.each(p,function(q,r){var s=/^controls$|^templates$|^views$|^services$/.exec(r);if(s){if(q instanceof Array){g(q,n,r);}else{if(b(q)){n[r]=q.call(n,n);}else{k.each(q,function(u,t){n[r]=n[r]||{};n[r][t]=n[r][t]={};i(n[r],t,f(u,n,r));
});}}}else{n[r]=f(q,n,r);}});}function g(o,n,p){k.each(o,function(q){n[p]=n[p]||{};if(a(q)){n[p][q]=n[q]||{};i(n[p],q,l(n,p,q));}else{k.each(q,function(s,r){i(n[p],r,f(s,n,p));});}});}function f(o,n,p){return a(o)?l(n,p,o):(b(o)?o():o);}function i(n,o,p){n[o]=p;}function l(n,p,o){if(n.injector){k.Module.dependency=k.Module.dependency||{};
var q=k.Module.dependency[n.injector];if(q){if(q[p][o]){return q[p][o](n);}}}return h(n,p,o);}function m(n){return n.substr(0,1).toUpperCase()+n.substr(1);}function h(n,p,o){if(o.indexOf(".")>0){try{return d(o,n.injectLocalMessageBus?n.localMessageBus:n.messageBus);}catch(r){k.errorLogger(r);throw new Error("Direct dependency instance creation error: ("+p+","+o+" | "+(m(o))+")");
}}var q=e[p];k.Module[q]=k.Module[q]||{};if(p==="templates"){if(k.Module.template[m(o)]){return new k.Module.template[m(o)]();}if(k.Module.template[o]){return k.Module.template[o];}if(o.indexOf("tmpl!")===0){return k.TemplateByURL(o.substr(5));}return k.TemplateByID("tmpl"+m(o));}try{return new k.Module[q][m(o)](n.injectLocalMessageBus?n.localMessageBus:n.messageBus);
}catch(r){k.errorLogger(r);throw new Error("Dependency instance creation error: ("+p+","+o+" | "+q+"."+(m(o))+")");}}function d(n,p){var o=window;k.each(n.split("."),function(q){o=o[q];});return new o(p);}function j(r){if(a(r)){var q={};var p=r.split(":");var o=p[1];var n=p[0];k.each({"templates":/T/,"views":/V/,"services":/S/},function(t,s){if(t.test(n)){q[s]=[o];
}});r=q;}return r;}function b(n){return typeof n==="function";}function a(n){return typeof n==="string";}}(Mettle));(function(a){a.registerHelper("list",function(d,j,f){var e,h,b,g="",c="";if(typeof j==="string"){g=" class='"+j+"' ";c=" class='"+j+"-item' ";}else{f=j;}e="<ul"+g+">";if(d&&d.length){for(h=0,b=d.length;
h<b;h++){e+="<li"+c+">"+f.fn(d[h])+"</li>";}}return e+"</ul>";});}(Handlebars));(function(a){Handlebars.registerHelper("i18n",function(b,c){c=typeof c==="object"?null:c;return new Handlebars.SafeString(a.i18n(b,c));});}(Mettle));(function(a){a.i18n=function(d,c){if(!a.i18nT){throw new Error("No resource bundle included for i18n!!");
}if(d===null){return"";}var b;if(c){b=c;}else{b=d.toLowerCase().replace(/ ([a-z])/g,function(e,f){return f.toUpperCase();}).replace(/ /g,"");b=b.charAt(0).toLowerCase()+b.substring(1);}return a.i18nT[b]||"!!!"+d+"!!!";};}(Mettle));(function(f,e){var h;var b;var d={};var g=false;var a="#/home";var c=function(){function p(t){a=t;
e(window).on("hashchange",q);if(location.hash){q();}else{location.href="#/"+a;}}function q(){b=location.hash;var u=n(b);if(!u){location.href="#/"+a;return;}if(u.page!==h){i(h,u);h=u.page;l(h,u);}var t=n(location.hash);if(!g){if(!m(h)||r(t)){k(t);}}d[h]=u;window.setTimeout(function(){g=false;},200);}function r(t){return(!d[h]||(t.pageData!==d[t.page].pageData));
}function k(t){f.messaging.publish("navigationStateChange:"+h,t);f.messaging.publish("navigationStateChange",t);}function i(u,t){if(u){e("a[href$='#/"+u+"']").removeClass("selected");e("#"+u).removeClass("page-visible");f.messaging.publish("navigationChangedFrom:"+u,t);}}function l(w,u){e("#"+w).addClass("page-visible");
var t=s(w);t.addClass("selected");var v=d[w];if(v){if(v.pageData){location.replace("#/"+w+"/"+v.pageData);if(m(w)){g=true;}}}if(!g){f.messaging.publish("navigationChangedTo:"+h,u);}}function m(u){var t=s(u).attr("data-keep-state");return !(t===false||t==="false");}function s(t){return e("a[href$='#/"+t+"']");
}function n(u){var t=/#\/([a-zA-Z_\-0-9\$]+)(\/([\w\W]+))?/.exec(u);if(!t){return null;}return{path:u,page:t[1],pageData:t[3],keepPreviousState:m(t[1])};}function j(t){b=t;location.hash=t;if(window.hasOwnProperty("onhashchange")){q();}}function o(v,w,x,t){var u=new RegExp(("^"+w+"$").replace("?",".").replace(/:[a-zA-Z0-9-_]+/g,function(y){return"([a-zA-Z0-9-_]+)";
})).exec(b.substring(1).replace(/[\/]?$/,""));if(u){u.splice(0,1);x.apply(v,u);}else{if(t){t.call(v);}}}return{load:p,route:o,setRoute:j};};f.navigation=new c();}(Mettle,Mettle.DOM));(function(i,e){i.templateEngine={getById:j,getByCSSSelector:g,getByURL:b,getByString:c,process:a,safeString:d,remove:f};
function b(k,l){e.get(k,function(m){l(h(m));});}function d(k){return new Handlebars.SafeString(k);}function h(k){return Handlebars.compile(k);}function f(l){var k=e("#"+l);k.remove();}function c(k){return h(k);}function j(m){var k=e("#"+m);var l=k.html();k.remove();if(!l){throw new Error("Template id: "+m+", not found!!");
}else{return h(l);}}function g(l){var k=e(l).html();if(!k){throw new Error("Template selector: "+l+", not matched any!!");}else{return h(k);}}function a(l,k){return l(k);}}(Mettle,Mettle.DOM));